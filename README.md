# social_network_system_design
Домашнее задание по курсу System Design:
проектирование социальной сети для путешественников.

# Функциональные требования
- публикация постов с привязкой к месту путешествия  
Каждый пост может содержать описание до 2200 символов, включая знаки препинания и пробелы,
место путешествия, а также от 1 до 10 фотографий размером не более 2 МБ каждая.
- оценка и комментарии постов других путешественников
  длина комментария не более 1500 символов
- подписка на других путешественников
- поиск популярных мест для путешествий и просмотр постов о них  
Поиск по названию места и получение связанных постов
- просмотр ленты других путешественников и ленты пользователя, основанной на подписках в обратном хронологическом порядке  
Просмотр ленты подписок, ленты пользователя - последние посты сверху.
- поддержка мобильных устройств и десктопного браузера  
Возможность работы на всех современных мобильных устройствах и десктопных браузерах

# Нефункциональные требования
- аудитория СНГ
- доступность 99,95%
- 10000 DAU и заложено увеличение вдвое каждый год
- пик нагрузки приходится на июнь-август 
  - множитель сезона: х3
- данные храним всегда
- активность пользователя в среднем за день  
  - пролистывает 200 постов
  - оценивает 50 постов  
  - читает (открывает) 20 постов
  - комментирует 10 постов  
  - добавляет 0,11 постов (20 постов за 6 мес)
  - открывает 10 профилей пользователей, может смотреть их подписки и посты
  - добавляет 0,17 подписок (5 подписок в месяц)
  - делает поиск популярных мест 0,01 в день (1 раз в 3 мес)
- лимиты
  - пользователь может добавлять не более 30 постов в день  
  - пользователь может добавлять не более 1000000 подписок и иметь не более 1000000 подписчиков  
  - оценка представляет из себя лайк (других видов реакции не предусмотрено)
- тайминги  
  - создание поста 1 с  
  - добавление реакции/комментария 0,1 с  
  - добавление подписки 0,1 с  
  - поиск популярных мест 3 с  
  - получение постов пользователя 2-3 с

# Расчет нагрузки
- кол-во одновременных соединений = 10% DAU = 1000
- размеры данных  
  - добавление поста = (id, user_id, текст, created_at, место) = 8 + 8 + 2200 + 8 + 256 = 2,7 КБ
    У меня нет опыта разработки геосервиса, поэтому место - это просто строка (хотя понимаю, что неэффективно)
  - добавление фотографии = (id, image, created_at, post_id, user_id) = 8 Б + 2 МБ + 8 Б + 8 Б + 8 Б ~ 2 МБ
    Фото нельзя добавить без поста. Пользователь начинает создавать пост и добавляет в него фотографии.
  - добавление реакции = (id, user_id, post_id, created_at) =  8 + 8 + 8 + 8 = 24 Б
  - добавление комментария = (id, user_id, post_id, текст, created_at) = 8 + 8 + 8 + 1500 + 8 ~ 1,5 КБ  
  - добавление подписки = (id, following_user_id, followed_user_id, created_at) = 8 + 8 + 8 + 8 = 32 Б  
  
  - получение поста = (id, user_id, текст, created_at, место, likes_count, [id фотографий]) = 8 + 8 + 2200 + 8 + 512 + 8 + 8 * 10 = 2,7 КБ
    За один запрос получаем 20 постов, т.е. 2,7 КБ * 20 = 54 КБ
  - получение фотографии = (id, image, created_at, post_id, user_id, image_preview_url, image_url) = 8 Б + 2 МБ + 8 Б + 8 Б + 8 Б + 35 Б + 35 Б ~ 2 МБ
  - получение реакций для поста = (id, post_id, likes_count) = 8 + 8 + 8 = 24 Б
  - получение комментариев для поста = (id, post_id, count, [user_id, comment_text, created_at]) = 8 + 8 + 8 + (8 + 1500 + 8) ~ 1,5 КБ
    За один запрос получаем 10 комментариев, т.е. 1,5 КБ * 10 = 15 КБ
  - получение подписок пользователя = (id, user_id, count, [following_user_id]) = 8 + 8 + 8 + 8 = 32 КБ
  - поиск популярных мест = (id, user_id, search_text, [post_ids]) = 8 + 8 + 256 + 8 * 20 = 432 Б
    За один запрос получаем 20 постов
### Запись (write)
- посты
  - RPS = 10000 DAU * 0,11 / 86400 = 0,01
  - трафик = 0,01 * 2,7 КБ ~ 0,03 КБ/с
- фотографии
  пользователь добавляет 10 фотографий к посту, а постов добавляет 0,11 в день
  - RPS = 10000 DAU * 0,11 * 10 / 86400 = 0,1
  - трафик = 0,1 * 2 МБ = 0,2 МБ/с
- реакции
  - RPS = 10000 DAU * 50 / 86400 = 5,8
  - трафик = 5,8 * 24 Б = 139 Б/с
- комментарии
  - RPS = 10000 DAU * 10 / 86400 = 1,15
  - трафик = 1,15 * 1,5 КБ = 1,65 КБ/с
- подписки
  - RPS = 10000 DAU * 0,17 / 86400 = 0,02
  - трафик = 0,02 * 32 Б = 0,7 Б/с

### Чтение (read)
- посты (пролистываем)
  - RPS = 10000 DAU * 200 / 86400 = 23
  - трафик = 23 * 54 КБ = 1240 КБ
- посты (читаем)
  - RPS = 10000 DAU * 20 / 86400 = 2,3
  - трафик = 2,3 * 54 КБ = 124 КБ
- фотографии (получаем столько же раз, сколько читаем постов)
  - RPS = 10000 DAU * 20 * (10 фото в посте) / 86400 = 23
  - трафик = 23 * 2 МБ = 46 МБ
- реакции (получаем столько же раз, сколько пролистываем постов)
  - RPS = 10000 DAU * 200 / 86400 = 23
  - трафик = 23 * 24 Б = 0,5 КБ/с
- комментарии (получаем столько же раз, сколько читаем постов)
  - RPS = 10000 DAU * 20 / 86400 = 2,3
  - трафик = 2,3 * 15 КБ = 35 КБ/с
- подписки
  - RPS = 10000 DAU * 10 / 86400 = 1,15
  - трафик = 1,15 * 32 КБ = 37 КБ
- поиск популярных мест
  - RPS = 10000 DAU * 0,01 / 86400 = 0,001
  - трафик = 0,001 * 432 Б = 0,43 Б/с

# Расчет дисков на 1 год
- посты
    - IOPS = 1,2 (1 диск)
    - Throughput = 2 МБ/с (1 диск)
    - Capacity = 2 МБ/с * 86400 * 365 = 63 TБ (2 диска)
    - Итого HDD - 2 диска
- реакции
    - IOPS = 2,2 (1 диск)
    - Throughput = 320 Б/с (1 диск)
    - Capacity = 320 Б/с * 86400 * 365 = 10 ГБ (1 диск)
    - Итого HDD - 1 диск
- комментарии
    - IOPS = 13 (1 диск)
    - Throughput = 20 КБ/с (1 диск)
    - Capacity = 20 КБ/с * 86400 * 365 = 630 ГБ (1 диск)
    - Итого HDD - 1 диск
- подписки
    - IOPS = 0,02 (1 диск)
    - Throughput = 0,7 Б/с (1 диск)
    - Capacity = 0,7 Б/с * 86400 * 365 = 22 МБ (1 диск)
    - Итого HDD - 1 диск